# Generated by Django 5.2.8 on 2025-12-15 23:06

from django.db import migrations


FAQ_ENTRIES = [
    {
        "question": "What GitHub permissions do you request and why?",
        "answer": "We request read and write access to repository contents. You can either select specific repositories or allow access to all current and future repositories (though we will not attempt to access any repositories besides those connected).\r\n\r\nIf you choose the selection option, ensure that the repository you want to connect is included.",
    },
    {
        "question": "Can I connect with a private GitHub repository?",
        "answer": "No, only public GitHub repositories are supported at the moment.",
    },
]

EXISTING_REPO_INFO_ITEMS = [
    {
        "icon": "fas fa-question",
        "text": "Keep your workflow on GitHub and avoid duplicate uploading by importing tagged releases straight from GitHub",
    },
    {
        "icon": "fas fa-file-archive",
        "text": "GitHub release assets (the automatically generated zip file) are pulled into the model library and are available for download like any other release",
    },
    {
        "icon": "fas fa-lock",
        "text": "Releases imported from GitHub are private to begin with, letting you make sure everything looks right before requesting peer review or publishing",
    },
    {
        "icon": "fas fa-file-alt",
        "text": "Submissions are still required to contain source code and narrative documentation. We'll try to automatically categorize transferred files and let you make any corrections",
    },
    {
        "icon": "fas fa-tags",
        "text": "Software metadata like languages, license, etc. is extracted from the GitHub release and any existing `codemeta.json` or `CITATION.cff` files. Any missing fields can be filled in after importing",
    },
    {
        "icon": "fas fa-clipboard-check",
        "text": "Imported releases can be [peer reviewed](/reviews) just like any other submission, giving your model a DOI upon completion. Peer review **must** be requested **before** publishing.",
    },
    {
        "icon": "fas fa-edit",
        "text": "While unpublished or under review, you can still make changes to a release by updating the tag on GitHub and reimporting the release. A video tutorial demonstrates exactly how to do this.",
    },
]

NEW_REPO_INFO_ITEMS = [
    {
        "icon": "fas fa-question",
        "text": "Putting your model on GitHub makes it easier for authors and other researchers to keep track of changes and collaborate on development, while also boosting accessibility and unlocking an ecosystem of tools for making scientific software more reusable",
    },
    {
        "icon": "fas fa-code-branch",
        "text": "A git repository is automatically built for a model in the library by commiting **published** releases in order to a main branch, as well as seperate branches and tags for each release",
    },
    {
        "icon": "fas fa-users",
        "text": "In order to maintain attribution, the original submitter is set as the commit author, and all other authors as co-authors",
    },
    {
        "icon": "fas fa-upload",
        "text": "After connecting to a blank GitHub repository, you'll be able to push everything at once",
    },
    {
        "icon": "fas fa-sync-alt",
        "text": "New releases published in the model library or metadata changes to existing releases will be automatically added to the git repository but will require input to push to GitHub",
    },
    {
        "icon": "fas fa-download",
        "text": "We'll never overwrite any changes you make to any branch on the GitHub repository and if you make any new releases there, you'll be able to import them back into the model library",
    },
]

EXISTING_REPO_TUTORIAL_VIDEOS = [
    {
        "title": "",
        "youtube_id": "dQw4w9WgXcQ",
        "caption": "How to set up an existing repository and import releases into the model library",
    },
    {
        "title": "",
        "youtube_id": "dQw4w9WgXcQ",
        "caption": "How to update a GitHub release and re-import it",
    },
]

NEW_REPO_TUTORIAL_VIDEOS = [
    {
        "title": "",
        "youtube_id": "y6120QOlsfU",
        "caption": "How to set up and push a new git repository for your model in the library",
    }
]


def _get_github_config_for_default_site(apps):
    Site = apps.get_model("wagtailcore", "Site")
    GitHubIntegrationConfiguration = apps.get_model("library", "GitHubIntegrationConfiguration")
    default_site = Site.objects.get(is_default_site=True)
    return GitHubIntegrationConfiguration.objects.get(site=default_site)


def populate_initial_content(apps, schema_editor):
    config = _get_github_config_for_default_site(apps)

    GitHubIntegrationFaqEntry = apps.get_model("library", "GitHubIntegrationFaqEntry")
    GitHubIntegrationExistingRepoInfoItem = apps.get_model(
        "library", "GitHubIntegrationExistingRepoInfoItem"
    )
    GitHubIntegrationNewRepoInfoItem = apps.get_model("library", "GitHubIntegrationNewRepoInfoItem")
    GitHubIntegrationExistingRepoTutorialVideo = apps.get_model(
        "library", "GitHubIntegrationExistingRepoTutorialVideo"
    )
    GitHubIntegrationNewRepoTutorialVideo = apps.get_model(
        "library", "GitHubIntegrationNewRepoTutorialVideo"
    )

    for sort_order, row in enumerate(FAQ_ENTRIES):
        GitHubIntegrationFaqEntry.objects.create(
            configuration=config,
            sort_order=sort_order,
            question=row["question"],
            answer=row["answer"],
        )
    for sort_order, row in enumerate(EXISTING_REPO_INFO_ITEMS):
        GitHubIntegrationExistingRepoInfoItem.objects.create(
            configuration=config,
            sort_order=sort_order,
            icon=row["icon"],
            text=row["text"],
        )
    for sort_order, row in enumerate(NEW_REPO_INFO_ITEMS):
        GitHubIntegrationNewRepoInfoItem.objects.create(
            configuration=config,
            sort_order=sort_order,
            icon=row["icon"],
            text=row["text"],
        )
    for sort_order, row in enumerate(EXISTING_REPO_TUTORIAL_VIDEOS):
        GitHubIntegrationExistingRepoTutorialVideo.objects.create(
            configuration=config,
            sort_order=sort_order,
            title=row["title"],
            youtube_id=row["youtube_id"],
            caption=row["caption"],
        )
    for sort_order, row in enumerate(NEW_REPO_TUTORIAL_VIDEOS):
        GitHubIntegrationNewRepoTutorialVideo.objects.create(
            configuration=config,
            sort_order=sort_order,
            title=row["title"],
            youtube_id=row["youtube_id"],
            caption=row["caption"],
        )


class Migration(migrations.Migration):
    dependencies = [
        ("library", "0035_alter_githubintegrationfaqentry_options_and_more"),
    ]

    operations = [
        migrations.RunPython(populate_initial_content, migrations.RunPython.noop),
    ]
