{% extends "base.jinja" %}

{% block introduction %}
<h1>GitHub Sync Overview</h1>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10">
            <p>
                The <b>CoMSES Model Library GitHub Sync</b> feature allows you to connect your model in the library to a
                GitHub repository, enabling either a one-way or bidirectional sync of model source code and metadata
                between
                the two platforms.
            </p>
            <p>
                Get started by pressing <span class="btn btn-sm btn-outline-secondary p-0 disabled"><i
                        class="fas fa-cog"></i> Configure</span>
                under the <strong>GitHub Sync</strong> tab on one of your models in the CoMSES Model Library. Others
                will be able to see any actively synced repositories here as well.
            </p>
        </div>
    </div>
    <hr />
    <div class="row justify-content-center mb-5">
        <div class="col-12 col-md-10">
            <h2 class="text-center my-3">Sync Directions</h2>
            <p class="text-center">
                The bidirectional sync between the CoMSES Model Library consists of two distinct processes, which can
                both be toggled on or off.
            <ul>
                <li>
                    Both processes will be enabled by default when generating a new repository from a model submission.
                </li>
                <li>
                    Alternatively, you can link an existing repository with only archiving enabled to import
                    new releases from GitHub, similarly to the <i>Zenodo</i> GitHub integration.
                </li>
            </ul>
            </p>
        </div>
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header d-flex align-items-center justify-content-between">
                    <h3 class="mb-0"><i class="fas fa-code-branch"></i> Push</h3>
                    <span class="text-muted">(CoMSES → GitHub)</span>
                </div>
                <div class="card-body">
                    <h5>How It Works</h5>
                    <ul class="px-3">
                        <li class="d-flex mb-2">
                            <i class="fas fa-code-branch pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                Published model releases are transformed into commits, branches,
                                and releases on GitHub, preserving your project's history and versioning
                            </div>
                        </li>
                        <li class="d-flex mb-2">
                            <i class="fas fa-user pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                In order to maintain attribution, the original submitter is set as the commit
                                author, and all other authors as co-authors
                                <p class="text-muted small mb-0">
                                    {% if not user.is_authenticated %}
                                    We will use a connected Github account or your profile information to sign commits.
                                    You can
                                    connect
                                    your Github account by editing your profile if you want it to appear as the author
                                    of the
                                    commits.
                                    {% elif user.member_profile.github_username %}
                                    Since you have a connected Github account, we will use it to sign commits:
                                    <code>{{ user.member_profile.github_username }} &lt;{{ user.member_profile.github_username }}@users.noreply.github.com&gt;</code>
                                    {% else %}
                                    Since you do not have a github account connected we will use your profile
                                    information:
                                    <code>{{ user.member_profile.name }} &lt;{{ user.email }}&gt;</code>
                                    {% endif %}
                                </p>
                            </div>
                        </li>
                        <li class="d-flex mb-2">
                            <i class="fas fa-tags pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                Metadata is preserved by adding to the GitHub repo where possible and stored in
                                versioned
                                <a href="https://codemeta.github.io/"><code>codemeta.json</code></a>,
                                <a
                                    href="https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/licensing-a-repository"><code>LICENSE</code></a>,
                                and <a href="https://citation-file-format.github.io/"><code>CITATION.cff</code></a>
                                files
                            </div>
                        </li>
                        <li class="d-flex">
                            <i class="fas fa-sync-alt pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                Each time a new release is published on the Model Library, or metadata for an existing
                                one is updated, the GitHub repository is
                                updated automatically
                            </div>
                        </li>
                    </ul>
                    <hr />
                    <h5>Considerations</h5>
                    <ul class="px-3">
                        <li class="d-flex mb-2">
                            <i class="fas fa-exclamation-triangle pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                Changes made to any generated branches on GitHub will cause that branch to longer be
                                automatically updated by the Model Library
                            </div>
                        </li>
                        <li class="d-flex">
                            <i class="fas fa-exclamation-triangle pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                Individual files cannot exceed 100MB
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header d-flex align-items-center justify-content-between">
                    <h3 class="mb-0"><i class="fas fa-archive"></i> Archive</h3>
                    <span class="text-muted">(GitHub → CoMSES)</span>
                </div>
                <div class="card-body">
                    <h5>How It Works</h5>
                    <ul class="px-3">
                        <li class="d-flex mb-2">
                            <i class="fas fa-rocket pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                Whenever you <a
                                    href="https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository">publish
                                    a new release</a> on a linked GitHub repository with
                                archiving enabled, the release is automatically imported as a new release of your model
                                in the CoMSES Model Library
                            </div>
                        </li>
                        <li class="d-flex mb-2">
                            <i class="fas fa-lock pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                Releases imported from GitHub are initially unpublished in the Model Library, allowing
                                you to
                                approve the extracted metadata, make any last-minute changes (by updating the
                                corresponding GitHub release),
                                and request peer review.
                            </div>
                        </li>
                        <li class="d-flex mb-2">
                            <i class="fas fa-file-archive pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                The release assets for the GitHub release are imported to the model library, and are
                                available for download like any other release
                            </div>
                        </li>
                        <li class="d-flex">
                            <i class="fas fa-tags pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                In order to populate metadata for the release record in the Model Library,
                                <code>codemeta.json</code> and/or
                                <code>CITATION.cff</code> files placed in the root of the repository will be parsed
                            </div>
                        </li>
                    </ul>
                    <hr />
                    <h5>Considerations</h5>
                    <ul class="px-3">
                        <li class="d-flex mb-2">
                            <i class="fas fa-exclamation-triangle pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                Metadata files describing the model software should be well-formed and kept up to date
                                in the repository to ensure accurate information is imported
                            </div>
                        </li>
                        <li class="d-flex mb-2">
                            <i class="fas fa-exclamation-triangle pt-1" style="width: 1rem"></i>
                            <div class="ps-3 flex-grow-1">
                                Archived releases do not enforce a certain directory structure, instead pulling in the
                                release assets as-is, so you must ensure this contains all of your source code,
                                documentation, and other necessary files
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <hr />
    {% set faq_entries = {
    "What GitHub permissions do you request and why?": "We request read and write access to repository contents. You can
    either select specific repositories or allow access to all current and future repositories (though we will not
    attempt to access any repositories besides those synced). If you choose the selection option, ensure that the
    repository you want to sync is included, which may require updating the selection after creating a blank repository
    if you are setting up a new sync from scratch.",

    "Can I sync with a private repository?": "Yes, there are no restrictions on syncing with private repositories.",

    "Can releases imported to the Model Library from GitHub be peer reviewed?": "Yes. Imported releases will be
    unpublished initially, allowing you to request a peer review or publish them. However, once a release is published,
    you can no longer request a review. While under peer review, the release remains private. If changes are requested,
    you must push changes to GitHub, create a new tag, and update the existing release to reference the new tag.",

    "If I set up archiving for an existing repository, will my existing releases be imported?": "No, only future
    releases will be imported. This is to prevent duplicate releases from being created.",

    "I created a GitHub release but don't see it on the CoMSES Model Library side, what went wrong?": "Ensure that the
    app is installed with the correct permissions. Also, check that the release is **published** (not a draft or in
    pre-release mode). If everything seems correct and it's still not appearing, please contact us.",

    "I set up a new synced repository or published a new release, but I don't see anything on the GitHub repository,
    what went wrong?": "If changes were made to a branch on GitHub, the sync process will not overwrite them. Ensure
    that the app is installed with the correct permissions. If issues persist, please contact us."
    } %}
    <div class="row justify-content-center">
        <div class="col-12" role="tablist" aria-multiselectable="true">
            <h2 class="text-center my-3">Frequently Asked Questions</h2>
            {% for question, answer in faq_entries.items() %}
            {% set entry_id = "entry_" ~ loop.index %}
            {% set heading_id = "faqHeading_" ~ loop.index %}
            <div class='card'>
                <div class='card-header' role='tab' id='{{ heading_id }}'>
                    <h5 class='mb-0'>
                        <button class='btn btn-link' data-bs-toggle='collapse' data-bs-target='#{{entry_id}}'
                            aria-expanded='false' aria-controls='{{entry_id}}'>
                            {{ question }}
                        </button>
                    </h5>
                </div>
                <div id='{{entry_id}}' class='collapse' aria-labelledby='{{ heading_id }}'>
                    <div class='card-body'>
                        {{ answer }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}