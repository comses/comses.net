{% extends "base.jinja" %}
{% from "common.jinja" import list_page, paginator %}

{% macro search_component() %}
    <form class="form-group row" action="{{ url('library:codebase-list') }}" method="get" enctype="application/x-www-form-urlencoded">
        <div class="col-xs-12 col-sm-9">
            <input type="text" class="form-control" name="query" placeholder="Search" value="{{ query or '' }}">
        </div>
        <div class="col-sm-3">
            <button class="btn btn-primary">Search</button>
            <a href="{{ url('library:codebase-create') }}" class="btn btn-primary btn float-md-right mt-xs-1">
                <i class="fa fa-plus"></i>
            </a>
        </div>
    </form>
{% endmacro %}

{% block title %}Codebases{% endblock %}

{% block introduction %}<h1 id="query">Codebases</h1>{% endblock %}

{% block subheader %}<h1>Codebases</h1>{% endblock %}

{% block content %}
    <div id="app"></div>
    {{ list_page(__all__, render_codebase_result, 'library:codebase-detail') }}
    <br>
    {{ paginator('library:codebase-list', __all__) }}
{% endblock %}

{% macro render_codebase_result(item, detail_url_name) %}
    <div class="search-result">
        <div class="date-info">
            <small class="text-muted">Last Updated: {{ item.last_modified }}</small>
            <small class="text-muted pull-right">Created on: {{ item.date_created }}</small>
        </div>
        <div class="title">
            <h1 class="p-0 m-0"><a href="{{ url("library:codebase-detail", identifier=item.identifier) }}">{{ item.title }}</a></h1>
            <small>Submitted by:
                {# FIXME: this should delegate to MemberProfile.get_absolute_url instead #}
                <a href="{{ item.submitter.profile_url }}/">{{ item.submitter.username }}</a>
            </small>
        </div>
        {% if item.summary %}
        <div class="summary">
            {{ markdown(item.summary)|safe }}
        </div>
        {% endif %}
        {%  if item.tags %}
            <div class="tag-list">
                {% for tag in item.tags %}
                    <span class="badge badge-primary p-1">{{ tag.name }}</span>
            {% endfor %}
            </div>
        {%  endif %}
    </div>
{% endmacro %}

{% block js %}
    {# {{ render_bundle('codebase_list') }} #}
{% endblock %}
